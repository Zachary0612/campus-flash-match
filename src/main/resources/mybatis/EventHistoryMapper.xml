<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.campus.mapper.EventHistoryMapper">

    <!-- 自定义插入方法，处理JSONB类型 -->
    <insert id="insertEventHistory" parameterType="com.campus.entity.EventHistory">
        INSERT INTO event_history (
            event_id, user_id, event_type, title, target_num, current_num, 
            expire_minutes, ext_meta, status, create_time, expire_time
        ) VALUES (
            #{eventId}, #{userId}, #{eventType}, #{title},
            #{targetNum}, #{currentNum}, #{expireMinutes},
            #{extMeta}::jsonb, #{status}, #{createTime}, #{expireTime}
        )
    </insert>

    <!-- 批量插入事件历史记录 -->
    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO event_history (
            event_id, user_id, event_type, title, target_num, current_num, 
            expire_minutes, ext_meta, participants, status, create_time, 
            expire_time, settle_time
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
                #{item.eventId}, #{item.userId}, #{item.eventType}, #{item.title},
                #{item.targetNum}, #{item.currentNum}, #{item.expireMinutes},
                #{item.extMeta}::jsonb, #{item.participants}, #{item.status},
                #{item.createTime}, #{item.expireTime}, #{item.settleTime}
            )
        </foreach>
    </insert>

</mapper>
